 <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calendario de Vacaciones</title>
  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/80a148_884889656ece456887fdba8c21949589~mv2.png/v1/fill/w_32,h_32,q_85,usm_0.66_1.00_0.01/80a148_884889656ece456887fdba8c21949589~mv2.png">
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Sora', sans-serif;
      background: #f8f6ee;
      margin: 0;
      padding: 2rem;
      position: relative;
      overflow-x: hidden;
    }

    h1 {
      text-align: center;
      color: #5c332d;
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .calendar-controls {
      text-align: center;
      margin-bottom: 2rem;
      font-weight: bold;
    }

    .calendar-controls button {
      background: #4b3935;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      margin: 0 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
    }

    .calendar-controls button:hover {
      background: #8b6f52;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      max-width: 900px;
      margin: 1rem auto 2rem;
      position: relative;
      z-index: 1;
    }

    .day {
      padding: 1.2rem;
      border-radius: 12px;
      background: #fff;
      text-align: center;
      position: relative;
      transition: 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      cursor: default;
      overflow: visible;
      z-index: 1;
    }

    .day:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      color: white;
      font-size: 0.8rem;
      padding: 6px 8px;
      border-radius: 6px;
      white-space: nowrap;
      z-index: 999;
      opacity: 1;
      pointer-events: none;
    }

    .day.inactive {
      opacity: 0.9;
    }

    .highlight {
      background-color: var(--highlight-color);
      opacity: 0.7;
    }

    .weekday {
      font-weight: bold;
      color: #d00b19;
    }

    .floating-gif {
      position: fixed;
      width: 90px;
      animation: float 4s ease-in-out infinite;
      z-index: 0;
    }

    .floating-gif:nth-child(2) { top: 5%; left: 10%; animation-delay: 0s; }
    .floating-gif:nth-child(3) { top: 15%; right: 5%; animation-delay: 1s; }
    .floating-gif:nth-child(4) { bottom: 10%; left: 15%; animation-delay: 2s; }
    .floating-gif:nth-child(5) { bottom: 5%; right: 10%; animation-delay: 3s; }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
      100% { transform: translateY(0); }
    }
  </style>
</head>
<body>

  <img class="floating-gif" src="https://custom-doodle.com/wp-content/uploads/doodle/hot-cup-of-coffee-pixel/hot-cup-of-coffee-pixel-doodle.gif" />
  <h1>Calendario de Vacaciones</h1>

  <div class="calendar-controls">
    <button id="prevMonth">⟨ Anterior</button>
    <span id="monthYear"></span>
    <button id="nextMonth">Siguiente ⟩</button>
  </div>

  <div class="calendar" id="calendar"></div>

  <div style="max-width: 900px; margin: 2rem auto; font-size: 0.95rem; background: #fff8f5; border-radius: 12px; padding: 1.2rem 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <h3 style="margin-top: 0; color: #5c332d;">Simbología por Departamento</h3>
    <ul style="list-style: none; padding-left: 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem 1rem;">
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#F16EBB;margin-right:8px;"></span>Administración</li>
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#fe8f0f;margin-right:8px;"></span>Logística</li>
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#F9E79F;margin-right:8px;"></span>Compras</li>
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#A1E3A1;margin-right:8px;"></span>Contabilidad</li>
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#BF0000;margin-right:8px;"></span>Servicio Técnico</li>
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#0264ed;margin-right:8px;"></span>Ventas</li>
      <li><span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:#8c8c94;margin-right:8px;"></span>BI</li>
    </ul>
    <h5>**Algunos colores no corresponderán al de la simbología en caso de que dos o más personas se ausenten el mismo día</h5>
  </div>

  <script>
    const calendarContainer = document.getElementById('calendar');
    const monthYearLabel = document.getElementById('monthYear');
    const prevBtn = document.getElementById('prevMonth');
    const nextBtn = document.getElementById('nextMonth');

    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT3sBCyILYWeazT0s2R7lq2MpD-WrK9GmZ9_QUtn11RB1THxSGooGuWcb9hWyKbIfTBBVXyn9J3ikf4/pub?output=csv";

    const deptColors = {
      "Administración": "#F16EBB",
      "Logística": "#fe8f0f",
      "Compras": "#F9E79F",
      "Contabilidad": "#A1E3A1",
      "Servicio Técnico": "#BF0000",
      "Ventas": "#0264ed",
      "BI": "#8c8c94"
    };

    const weekdays = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let absencesData = [];

    const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();

    const renderCalendar = () => {
      calendarContainer.innerHTML = '';
      monthYearLabel.textContent = `${new Date(currentYear, currentMonth).toLocaleString('es-ES', { month: 'long', year: 'numeric' })}`;

      weekdays.forEach(day => {
        const div = document.createElement('div');
        div.className = 'day weekday';
        div.textContent = day;
        calendarContainer.appendChild(div);
      });

      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const totalDays = getDaysInMonth(currentYear, currentMonth);

      for (let i = 0; i < firstDay; i++) {
        const filler = document.createElement('div');
        filler.className = 'day inactive';
        calendarContainer.appendChild(filler);
      }

      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const div = document.createElement('div');
        div.className = 'day';
        div.textContent = day;

        const entries = absencesData.filter(d => d.date === dateStr);
        if (entries.length > 0) {
          if (entries.length === 1) {
            const entry = entries[0];
            div.style.setProperty('--highlight-color', deptColors[entry.dept] || '#ccc');
            div.classList.add('highlight');
            div.setAttribute('data-tooltip', `${entry.name} - ${entry.dept}`);
          } else {
            const colors = entries.map(e => deptColors[e.dept] || '#ccc');
            div.style.background = `linear-gradient(45deg, ${colors.join(',')})`;
            const tooltipText = entries.map(e => `${e.name} - ${e.dept}`).join(' / ');
            div.setAttribute('data-tooltip', tooltipText);
          }
        }

        calendarContainer.appendChild(div);
      }
    };

    fetch(sheetURL)
      .then(res => res.text())
      .then(csv => {
        const lines = csv.split('\n').slice(1);
        const data = [];

        lines.forEach(line => {
          const cols = line.split(',');
          const name = cols[6]?.trim();
          const dept = cols[1]?.trim();
          const start = new Date(cols[3]);
          const end = new Date(cols[4]);

          if (cols[5]?.toLowerCase().includes("aprobado")) {
            let current = new Date(start);
            while (current <= end) {
              data.push({
                name,
                dept,
                date: current.toISOString().split('T')[0]
              });
              current.setDate(current.getDate() + 1);
            }
          }
        });

        absencesData = data;
        renderCalendar();
      });

    prevBtn.addEventListener('click', () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    });

    nextBtn.addEventListener('click', () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    });
  </script>
</body>
</html>
